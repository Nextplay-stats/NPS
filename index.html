<script src="https://alcdn.msauth.net/browser/2.35.0/js/msal-browser.min.js"></script>
<script>
  const msalConfig = {
    auth: {
      clientId: "c4d18c3f-5c5d-4a64-811f-809f0bb50667",
      authority: "https://login.microsoftonline.com/ae49937b-e6e5-4c58-a720-c3d7ebd7f665",
      redirectUri: "https://ambitious-water-0dda8d803.6.azurestaticapps.net/admin"
    }
  };

  const msalInstance = new msal.PublicClientApplication(msalConfig);

  async function signIn() {
    try {
      const response = await msalInstance.loginPopup({
        scopes: ["openid", "profile", "email"],
      });

      const idToken = response.idToken;

      // Decode the JWT (it's just base64)
      const payload = JSON.parse(atob(idToken.split('.')[1]));
      const groupIds = payload.groups || [];

      // Map group ID to group name
      const groupMap = {
        "0c3a5074-675c-4441-b665-3709f2e389e3": "admin",
        "92eee0d9-de17-4056-8720-478601a22de1": "coach",
        "a0b86c5d-544e-4a0d-a10c-b16eac07cf00": "nbl",
        "bb89a797-92d2-4f1c-be21-8ba5200b427c": "players"
      };

      const matchedGroupId = groupIds.find(id => groupMap[id]);
      const groupName = groupMap[matchedGroupId];

      if (groupName) {
        window.location.href = `/groups/${groupName}.html`;
      } else {
        document.body.innerHTML = "<h2>Access Denied: You are not in an authorized group.</h2>";
      }
    } catch (err) {
      console.error(err);
    }
  }
</script>

<button onclick="signIn()">Login with Microsoft</button>
